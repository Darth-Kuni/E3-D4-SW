# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[mcu]
canbus_uuid: 4fbce31db688 
canbus_interface: can0

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include LCD.cfg]
[include klipperExpander.cfg]
[include lights.cfg]
#[include Knomi.cfg]
#[include lights.cfg]

[exclude_object]

[input_shaper]
#shaper_freq_x: ...
#shaper_type_x: ...
#shaper_freq_y: 34.6
#shaper_type_y: mzv

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 
position_endstop: 0
position_max: 220
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3203133.834,0.087500:3203106.927,0.131250:3202968.816,
#*# 	0.168750:3202814.337,0.212500:3202693.384,0.250000:3202550.224,
#*# 	0.287500:3202433.122,0.331250:3202265.911,0.368750:3202154.514,
#*# 	0.412500:3202011.902,0.450000:3201891.848,0.487500:3201761.869,
#*# 	0.531250:3201618.710,0.568750:3201491.951,0.612500:3201355.163,
#*# 	0.650000:3201252.467,0.687500:3201123.215,0.731250:3201002.510,
#*# 	0.768750:3200877.192,0.812500:3200757.791,0.850000:3200613.029,
#*# 	0.887500:3200558.009,0.931250:3200430.726,0.968750:3200331.649,
#*# 	1.012500:3200221.773,1.050000:3200087.134,1.087500:3199992.465,
#*# 	1.131250:3199879.274,1.168750:3199768.653,1.212500:3199686.989,
#*# 	1.250000:3199589.948,1.287500:3199487.931,1.331250:3199381.160,
#*# 	1.368750:3199289.903,1.412500:3199183.483,1.450000:3199089.678,
#*# 	1.487500:3198997.815,1.531250:3198911.646,1.568750:3198830.513,
#*# 	1.612500:3198724.237,1.650000:3198662.880,1.687500:3198562.065,
#*# 	1.731250:3198470.982,1.768750:3198396.161,1.812500:3198317.106,
#*# 	1.850000:3198257.256,1.887500:3198169.779,1.931250:3198095.993,
#*# 	1.968750:3198001.217,2.012500:3197927.827,2.050000:3197871.126,
#*# 	2.087500:3197790.921,2.131250:3197714.832,2.168750:3197640.817,
#*# 	2.212500:3197543.738,2.250000:3197482.917,2.287500:3197422.512,
#*# 	2.331250:3197341.476,2.368750:3197273.789,2.412500:3197161.775,
#*# 	2.450000:3197125.656,2.487500:3197072.543,2.531250:3197000.762,
#*# 	2.568750:3196940.649,2.612500:3196877.686,2.650000:3196798.616,
#*# 	2.687500:3196754.730,2.731250:3196686.713,2.768750:3196630.642,
#*# 	2.812500:3196560.434,2.850000:3196518.596,2.887500:3196477.298,
#*# 	2.931250:3196398.111,2.968750:3196347.553,3.012500:3196274.648,
#*# 	3.050000:3196226.118,3.087500:3196173.962,3.131250:3196114.704,
#*# 	3.168750:3196071.955,3.212500:3196005.341,3.250000:3195967.037,
#*# 	3.287500:3195914.810,3.331250:3195866.646,3.368750:3195798.928,
#*# 	3.412500:3195762.618,3.450000:3195702.935,3.487500:3195664.580,
#*# 	3.531250:3195605.820,3.568750:3195567.565,3.612500:3195518.510,
#*# 	3.650000:3195470.053,3.687500:3195430.596,3.731250:3195377.640,
#*# 	3.768750:3195324.005,3.812500:3195283.982,3.850000:3195242.975,
#*# 	3.887500:3195196.178,3.931250:3195166.263,3.968750:3195124.841,
#*# 	4.012500:3195068.044,4.050000:3195028.428
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 44.570278
#*# drift_calibration =
#*# 	3206503.578909, -140.702231, 0.256452
#*# 	3205422.119093, -158.239716, 0.420097
#*# 	3204139.073566, -160.761158, 0.457291
#*# 	3203086.278667, -163.538286, 0.488145
#*# 	3202060.692626, -162.110196, 0.487142
#*# 	3201326.990672, -165.778260, 0.523838
#*# 	3200774.304907, -171.684449, 0.582086
#*# 	3200017.254884, -166.244211, 0.541809
#*# 	3199487.513943, -166.304102, 0.547092
#*# drift_calibration_min_temp = 36.512525486000264
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.147767, -0.052002, -0.015643, 0.023497, 0.035907, 0.035907, 0.042384, 0.055390, 0.042330, 0.019418, 0.056001, 0.077277, 0.077276, 0.116396, 0.143489, 0.159376, 0.214282, 0.257757, 0.198005
#*# 	  -0.038175, -0.003706, 0.014127, 0.031824, 0.041629, 0.010098, 0.042145, 0.047498, 0.047551, 0.055688, 0.055688, 0.072759, 0.096779, 0.118180, 0.141155, 0.165312, 0.217261, 0.255526, 0.217054
#*# 	  -0.023001, 0.030158, 0.035971, 0.057438, 0.033019, 0.033019, 0.069688, 0.071293, 0.057439, 0.058232, 0.072483, 0.087092, 0.106656, 0.124128, 0.154317, 0.141127, 0.206734, 0.248226, 0.172229
#*# 	  0.000020, 0.025911, 0.052664, 0.032605, 0.060266, 0.030751, 0.054263, 0.031444, 0.054745, 0.056351, 0.058037, 0.079532, 0.101065, 0.095382, 0.137198, 0.156976, 0.210651, 0.216403, 0.193602
#*# 	  0.013608, 0.027538, 0.058626, 0.081941, 0.057496, 0.044195, 0.070960, 0.082353, 0.055067, 0.063719, 0.083236, 0.067789, 0.103113, 0.115143, 0.141605, 0.161002, 0.191364, 0.220108, 0.177982
#*# 	  0.027652, 0.073577, 0.049151, 0.075984, 0.070864, 0.038131, 0.062557, 0.085548, 0.038131, 0.038131, 0.035287, 0.056975, 0.093401, 0.113379, 0.125738, 0.148718, 0.188289, 0.209509, 0.153886
#*# 	  0.039673, 0.047794, 0.078572, 0.092335, 0.064428, 0.066576, 0.076887, 0.084905, 0.044767, 0.065982, 0.065982, 0.062174, 0.064369, 0.098788, 0.130227, 0.141427, 0.162332, 0.191086, 0.083088
#*# 	  0.046339, 0.089862, 0.051870, 0.075656, 0.070840, 0.063558, 0.046240, 0.067969, 0.057668, 0.054375, 0.040851, 0.046261, 0.033246, 0.062577, 0.111734, 0.122559, 0.137890, 0.182176, 0.095856
#*# 	  0.055582, 0.088053, 0.080188, 0.098890, 0.054678, 0.079385, 0.078583, 0.080188, 0.065212, 0.008807, 0.061989, 0.065209, 0.078151, 0.082967, 0.115429, 0.118998, 0.131359, 0.158916, 0.103529
#*# 	  0.059219, 0.108080, 0.068062, 0.084786, 0.087315, 0.041988, 0.044152, 0.057415, 0.047613, 0.028892, 0.044398, 0.049756, 0.048737, 0.044703, 0.087246, 0.103541, 0.128315, 0.144849, 0.080485
#*# 	  0.058782, 0.064663, 0.067934, 0.066350, 0.090151, 0.065602, 0.067798, 0.055851, 0.049369, 0.046074, 0.030578, 0.052484, 0.045995, 0.058457, 0.070484, 0.062975, 0.090128, 0.099115, 0.067102
#*# 	  0.062450, 0.109316, 0.093008, 0.089791, 0.073478, 0.065534, 0.040506, 0.049192, 0.014111, 0.016533, 0.034511, 0.018957, 0.046993, 0.056209, 0.066013, 0.081751, 0.065430, 0.120827, 0.050240
#*# 	  0.060282, 0.099108, 0.089457, 0.086929, 0.074763, 0.062957, 0.064029, 0.045590, 0.046668, 0.034682, 0.036379, 0.036915, 0.036809, 0.043776, 0.056877, 0.061780, 0.057434, 0.062822, 0.036689
#*# 	  0.038156, 0.101779, 0.064685, 0.069975, 0.042474, 0.023574, 0.044091, 0.034266, 0.011328, -0.022945, 0.003451, -0.011253, -0.009549, 0.024727, 0.019940, 0.024728, 0.061680, 0.045433, 0.009243
#*# 	  0.032954, 0.068739, 0.061733, 0.068271, 0.060661, 0.045492, 0.010892, 0.034595, 0.013494, 0.002835, 0.002835, 0.005258, 0.002027, 0.000412, 0.024031, 0.028997, 0.023223, 0.044396, -0.011293
#*# 	  0.017272, 0.068374, 0.055883, 0.049342, 0.007020, -0.007653, -0.018945, -0.026203, -0.018158, -0.063387, -0.040906, -0.055054, -0.028179, -0.026633, -0.023960, -0.010447, 0.024765, 0.032922, -0.050041
#*# 	  0.033159, 0.046186, 0.037212, 0.040536, 0.033995, 0.000978, 0.000978, -0.007189, -0.055765, -0.055064, -0.046317, -0.050576, -0.072361, -0.055064, -0.037017, -0.034329, -0.038904, -0.005157, -0.069778
#*# 	  -0.003807, 0.030621, 0.016873, 0.009530, -0.005266, -0.029090, -0.048917, -0.074580, -0.070870, -0.109410, -0.104766, -0.107871, -0.082209, -0.081616, -0.069507, -0.064388, -0.050946, -0.018692, -0.084143
#*# 	  -0.004734, -0.021321, -0.018647, -0.024015, -0.063262, -0.076108, -0.079895, -0.081185, -0.114365, -0.130081, -0.097799, -0.145527, -0.130145, -0.135124, -0.116787, -0.104913, -0.086314, -0.077499, -0.130512
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 57.0
#*# shaper_type_y = ei
#*# shaper_freq_y = 61.2
