# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[mcu]
canbus_uuid: 4fbce31db688 
canbus_interface: can0

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include LCD.cfg]
[include klipperExpander.cfg]
[include lights.cfg]
#[include Knomi.cfg]
#[include lights.cfg]

[exclude_object]

[input_shaper]
#shaper_freq_x: ...
#shaper_type_x: ...
#shaper_freq_y: 34.6
#shaper_type_y: mzv

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 
position_endstop: 0
position_max: 220
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 57.0
#*# shaper_type_y = ei
#*# shaper_freq_y = 61.2
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3201773.131,0.087500:3201653.339,0.131250:3201537.219,
#*# 	0.168750:3201433.169,0.212500:3201339.423,0.250000:3201233.781,
#*# 	0.287500:3201117.748,0.331250:3200978.222,0.368750:3200832.903,
#*# 	0.412500:3200665.332,0.450000:3200580.321,0.487500:3200480.793,
#*# 	0.531250:3200335.898,0.568750:3200247.023,0.612500:3200109.353,
#*# 	0.650000:3200038.056,0.687500:3199901.583,0.731250:3199783.009,
#*# 	0.768750:3199670.648,0.812500:3199560.084,0.850000:3199459.759,
#*# 	0.887500:3199331.775,0.931250:3199237.953,0.968750:3199143.326,
#*# 	1.012500:3199057.857,1.050000:3198986.657,1.087500:3198867.902,
#*# 	1.131250:3198761.625,1.168750:3198673.727,1.212500:3198570.952,
#*# 	1.250000:3198487.717,1.287500:3198408.962,1.331250:3198315.699,
#*# 	1.368750:3198221.342,1.412500:3198131.460,1.450000:3198053.230,
#*# 	1.487500:3197965.786,1.531250:3197882.763,1.568750:3197783.651,
#*# 	1.612500:3197702.029,1.650000:3197634.471,1.687500:3197550.245,
#*# 	1.731250:3197469.460,1.768750:3197400.566,1.812500:3197323.668,
#*# 	1.850000:3197237.838,1.887500:3197172.248,1.931250:3197089.963,
#*# 	1.968750:3197038.738,2.012500:3196951.510,2.050000:3196890.068,
#*# 	2.087500:3196821.907,2.131250:3196737.638,2.168750:3196662.483,
#*# 	2.212500:3196594.214,2.250000:3196540.125,2.287500:3196470.521,
#*# 	2.331250:3196398.411,2.368750:3196336.160,2.412500:3196255.640,
#*# 	2.450000:3196193.394,2.487500:3196147.839,2.531250:3196077.222,
#*# 	2.568750:3196027.023,2.612500:3195965.726,2.650000:3195925.348,
#*# 	2.687500:3195853.151,2.731250:3195795.175,2.768750:3195727.159,
#*# 	2.812500:3195672.097,2.850000:3195620.976,2.887500:3195575.023,
#*# 	2.931250:3195510.380,2.968750:3195472.000,3.012500:3195403.084,
#*# 	3.050000:3195372.929,3.087500:3195308.950,3.131250:3195264.003,
#*# 	3.168750:3195212.589,3.212500:3195143.314,3.250000:3195095.978,
#*# 	3.287500:3195042.446,3.331250:3195011.007,3.368750:3194965.190,
#*# 	3.412500:3194915.654,3.450000:3194860.445,3.487500:3194808.963,
#*# 	3.531250:3194775.511,3.568750:3194735.157,3.612500:3194687.637,
#*# 	3.650000:3194641.277,3.687500:3194585.591,3.731250:3194549.509,
#*# 	3.768750:3194510.991,3.812500:3194462.242,3.850000:3194437.750,
#*# 	3.887500:3194394.870,3.931250:3194335.930,3.968750:3194293.531,
#*# 	4.012500:3194251.057,4.050000:3194225.579
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 31.677803
#*# drift_calibration =
#*# 	3210270.985112, -266.588152, 1.116138
#*# 	3206554.378854, -177.953257, 0.323198
#*# 	3204416.557038, -145.709242, 0.060458
#*# 	3202552.077956, -116.440989, -0.181757
#*# 	3201295.408854, -105.347403, -0.252816
#*# 	3199786.131692, -77.958033, -0.488171
#*# 	3198782.384243, -64.672813, -0.605395
#*# 	3197901.839244, -54.286773, -0.685088
#*# 	3197174.216089, -46.669659, -0.736806
#*# drift_calibration_min_temp = 34.86621262956116
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.053149, 0.000132, -0.032093, 0.032153, 0.011708, -0.014251, -0.039766, -0.079297, -0.037088, -0.076786, -0.070741, -0.073129, -0.098923, -0.069154, -0.085804, -0.039474, -0.033526, -0.006509, -0.101406
#*# 	0.001696, 0.055648, 0.033599, 0.004231, 0.042914, 0.018859, -0.015454, -0.035799, -0.053671, -0.053481, -0.072920, -0.080581, -0.067378, -0.078776, -0.067369, -0.032478, -0.029156, -0.013929, -0.101406
#*# 	0.040137, 0.033915, 0.059920, 0.012545, 0.026969, 0.032214, -0.028695, -0.004929, -0.000458, -0.040302, -0.047783, -0.043633, -0.045289, -0.048612, -0.046955, -0.042681, -0.008109, -0.022330, -0.083911
#*# 	0.062830, 0.090450, 0.078731, 0.046015, 0.065222, 0.033164, 0.014128, -0.042654, -0.024814, -0.029993, -0.040993, -0.047777, -0.067330, -0.042668, -0.032422, -0.012727, 0.013378, 0.021911, -0.085398
#*# 	0.053633, 0.112205, 0.080208, 0.094780, 0.065831, 0.046868, 0.022402, -0.022548, -0.022548, -0.048847, -0.020049, -0.026834, -0.038738, -0.030167, -0.030541, -0.022089, 0.017971, -0.008114, -0.117261
#*# 	0.066570, 0.115229, 0.123359, 0.093733, 0.084865, 0.052143, 0.036580, 0.011635, -0.005849, -0.016836, -0.043983, -0.026956, -0.038853, -0.030400, -0.045640, 0.001955, 0.028913, 0.010638, -0.082908
#*# 	0.098533, 0.080389, 0.088893, 0.115566, 0.117552, 0.062758, 0.038559, 0.033330, 0.005652, -0.010738, -0.036445, -0.010738, -0.023450, -0.021792, 0.027214, 0.013658, 0.024368, 0.003898, -0.087811
#*# 	0.118754, 0.133321, 0.141360, 0.108638, 0.065805, 0.069483, 0.043302, 0.025369, 0.015075, 0.003499, -0.038478, -0.014648, -0.043591, 0.008375, -0.028235, 0.008227, 0.037143, 0.035967, -0.077331
#*# 	0.098846, 0.131499, 0.123507, 0.123411, 0.108965, 0.078523, 0.059124, 0.052189, 0.026769, -0.017844, 0.018158, 0.000673, -0.014518, -0.016177, 0.018169, 0.009495, 0.049498, 0.002037, -0.075183
#*# 	0.115911, 0.131366, 0.139457, 0.125263, 0.115043, 0.082493, 0.060573, 0.016607, 0.031037, 0.016592, 0.007857, -0.022694, -0.034320, -0.032662, -0.002626, 0.026537, 0.037029, 0.012983, -0.080207
#*# 	0.130356, 0.149236, 0.135751, 0.137027, 0.116871, 0.092150, 0.064718, 0.050842, 0.031731, 0.022364, 0.003099, -0.014182, 0.001052, 0.002951, 0.022353, 0.026151, 0.035262, 0.037505, -0.067811
#*# 	0.142062, 0.172030, 0.129944, 0.129944, 0.119128, 0.091169, 0.095609, 0.071573, 0.030726, 0.034468, 0.011456, 0.005621, -0.018627, 0.026927, 0.012003, 0.000332, 0.020682, 0.013891, -0.059449
#*# 	0.145943, 0.162377, 0.143197, 0.116732, 0.102760, 0.098473, 0.072133, 0.059263, 0.008453, 0.048912, 0.047167, 0.024877, 0.011461, -0.016969, 0.032154, -0.003212, 0.029774, 0.031504, -0.103518
#*# 	0.138323, 0.175979, 0.154772, 0.149783, 0.131455, 0.100157, 0.068646, 0.053056, 0.039047, 0.037342, 0.003841, 0.015369, -0.018540, 0.003841, 0.017418, 0.023108, 0.045101, 0.019667, -0.099168
#*# 	0.146430, 0.162247, 0.161390, 0.137631, 0.123422, 0.095780, 0.071728, 0.059058, 0.039930, -0.023392, 0.029263, 0.017594, 0.013767, -0.038682, 0.019607, 0.015805, -0.013227, 0.033641, -0.069211
#*# 	0.159379, 0.168382, 0.150845, 0.134482, 0.099112, 0.090377, 0.058161, 0.039986, 0.036584, 0.021677, -0.033543, 0.000360, -0.031873, -0.001531, -0.003422, 0.015846, 0.031334, 0.013944, -0.076632
#*# 	0.146466, 0.121125, 0.129277, 0.131363, 0.108770, 0.078112, 0.053643, 0.044865, -0.020498, 0.001869, 0.008966, -0.002731, -0.020861, -0.010319, -0.022522, 0.024606, 0.011809, 0.007064, -0.083428
#*# 	0.139474, 0.123827, 0.092000, 0.106328, 0.104182, 0.042907, 0.013022, 0.016114, -0.038618, -0.010220, -0.022438, -0.027573, -0.059353, -0.032012, -0.030350, -0.037146, 0.000157, -0.018400, -0.084633
#*# 	0.096809, 0.104732, 0.079326, 0.059191, 0.047956, 0.049654, -0.002017, -0.023701, -0.058205, -0.092102, -0.083150, -0.048292, -0.077977, -0.109010, -0.131617, -0.081354, -0.050257, -0.071505, -0.126099
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
