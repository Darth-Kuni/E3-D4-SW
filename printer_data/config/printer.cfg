# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[mcu]
canbus_uuid: 4fbce31db688 
canbus_interface: can0

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include LCD.cfg]
[include klipperExpander.cfg]
[include lights.cfg]
#[include Knomi.cfg]
#[include lights.cfg]

[exclude_object]

[input_shaper]
#shaper_freq_x: ...
#shaper_type_x: ...
#shaper_freq_y: 34.6
#shaper_type_y: mzv

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 
position_endstop: 0
position_max: 220
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3203133.834,0.087500:3203106.927,0.131250:3202968.816,
#*# 	0.168750:3202814.337,0.212500:3202693.384,0.250000:3202550.224,
#*# 	0.287500:3202433.122,0.331250:3202265.911,0.368750:3202154.514,
#*# 	0.412500:3202011.902,0.450000:3201891.848,0.487500:3201761.869,
#*# 	0.531250:3201618.710,0.568750:3201491.951,0.612500:3201355.163,
#*# 	0.650000:3201252.467,0.687500:3201123.215,0.731250:3201002.510,
#*# 	0.768750:3200877.192,0.812500:3200757.791,0.850000:3200613.029,
#*# 	0.887500:3200558.009,0.931250:3200430.726,0.968750:3200331.649,
#*# 	1.012500:3200221.773,1.050000:3200087.134,1.087500:3199992.465,
#*# 	1.131250:3199879.274,1.168750:3199768.653,1.212500:3199686.989,
#*# 	1.250000:3199589.948,1.287500:3199487.931,1.331250:3199381.160,
#*# 	1.368750:3199289.903,1.412500:3199183.483,1.450000:3199089.678,
#*# 	1.487500:3198997.815,1.531250:3198911.646,1.568750:3198830.513,
#*# 	1.612500:3198724.237,1.650000:3198662.880,1.687500:3198562.065,
#*# 	1.731250:3198470.982,1.768750:3198396.161,1.812500:3198317.106,
#*# 	1.850000:3198257.256,1.887500:3198169.779,1.931250:3198095.993,
#*# 	1.968750:3198001.217,2.012500:3197927.827,2.050000:3197871.126,
#*# 	2.087500:3197790.921,2.131250:3197714.832,2.168750:3197640.817,
#*# 	2.212500:3197543.738,2.250000:3197482.917,2.287500:3197422.512,
#*# 	2.331250:3197341.476,2.368750:3197273.789,2.412500:3197161.775,
#*# 	2.450000:3197125.656,2.487500:3197072.543,2.531250:3197000.762,
#*# 	2.568750:3196940.649,2.612500:3196877.686,2.650000:3196798.616,
#*# 	2.687500:3196754.730,2.731250:3196686.713,2.768750:3196630.642,
#*# 	2.812500:3196560.434,2.850000:3196518.596,2.887500:3196477.298,
#*# 	2.931250:3196398.111,2.968750:3196347.553,3.012500:3196274.648,
#*# 	3.050000:3196226.118,3.087500:3196173.962,3.131250:3196114.704,
#*# 	3.168750:3196071.955,3.212500:3196005.341,3.250000:3195967.037,
#*# 	3.287500:3195914.810,3.331250:3195866.646,3.368750:3195798.928,
#*# 	3.412500:3195762.618,3.450000:3195702.935,3.487500:3195664.580,
#*# 	3.531250:3195605.820,3.568750:3195567.565,3.612500:3195518.510,
#*# 	3.650000:3195470.053,3.687500:3195430.596,3.731250:3195377.640,
#*# 	3.768750:3195324.005,3.812500:3195283.982,3.850000:3195242.975,
#*# 	3.887500:3195196.178,3.931250:3195166.263,3.968750:3195124.841,
#*# 	4.012500:3195068.044,4.050000:3195028.428
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 44.570278
#*# drift_calibration =
#*# 	3206503.578909, -140.702231, 0.256452
#*# 	3205422.119093, -158.239716, 0.420097
#*# 	3204139.073566, -160.761158, 0.457291
#*# 	3203086.278667, -163.538286, 0.488145
#*# 	3202060.692626, -162.110196, 0.487142
#*# 	3201326.990672, -165.778260, 0.523838
#*# 	3200774.304907, -171.684449, 0.582086
#*# 	3200017.254884, -166.244211, 0.541809
#*# 	3199487.513943, -166.304102, 0.547092
#*# drift_calibration_min_temp = 36.512525486000264
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.155542, -0.056028, -0.015069, -0.001840, -0.005038, -0.001547, 0.043508, 0.040289, 0.045689, 0.044616, 0.066233, 0.086829, 0.099033, 0.119184, 0.140280, 0.185939, 0.230011, 0.275060, 0.238338
#*# 	-0.041139, 0.018635, 0.025990, 0.037512, 0.013799, 0.018689, 0.043463, 0.036961, 0.048066, 0.024851, 0.052947, 0.070175, 0.088011, 0.118216, 0.118222, 0.180611, 0.224518, 0.257359, 0.201268
#*# 	-0.033684, 0.022176, 0.034990, 0.054975, 0.054975, 0.038757, 0.064136, 0.071562, 0.056054, 0.067846, 0.083581, 0.075488, 0.113231, 0.129078, 0.132623, 0.155400, 0.200014, 0.260477, 0.218543
#*# 	-0.003816, -0.006241, 0.056648, 0.040954, 0.048158, 0.052480, 0.056271, 0.043298, 0.033544, 0.041650, 0.056807, 0.073495, 0.105944, 0.118270, 0.145245, 0.164428, 0.213999, 0.236185, 0.200410
#*# 	0.018212, 0.033379, -0.003233, 0.077937, 0.063517, 0.057572, 0.079518, 0.081179, 0.068389, 0.065117, 0.087664, 0.087664, 0.103822, 0.122237, 0.177969, 0.167704, 0.167704, 0.224438, 0.183099
#*# 	0.034947, 0.071243, 0.074459, 0.055227, 0.073655, 0.059059, 0.067142, 0.049832, 0.057414, 0.060663, 0.035979, 0.045680, 0.097405, 0.086905, 0.131515, 0.157216, 0.151218, 0.205387, 0.164116
#*# 	0.038158, 0.041438, 0.065209, 0.087766, 0.076404, 0.069089, 0.081683, 0.093809, 0.075962, 0.048701, 0.081590, 0.054644, 0.093809, 0.086494, 0.134138, 0.142307, 0.170499, 0.193307, 0.137996
#*# 	0.033915, 0.087573, 0.092423, 0.060209, 0.085107, 0.065091, 0.066158, 0.066692, 0.061819, 0.034262, 0.052282, 0.049564, 0.075667, 0.092763, 0.085447, 0.112191, 0.124554, 0.180397, 0.108838
#*# 	0.053878, 0.078111, 0.082936, 0.076460, 0.065245, 0.056555, 0.080524, 0.080329, 0.066723, 0.030095, 0.068364, 0.076318, 0.055358, 0.097373, 0.117354, 0.124987, 0.127306, 0.157479, 0.112880
#*# 	0.057984, 0.101309, 0.066138, 0.094771, 0.091555, 0.070447, 0.040367, 0.041976, 0.058214, 0.053338, 0.046835, 0.055478, 0.040367, 0.069898, 0.099161, 0.113383, 0.136846, 0.146282, 0.103312
#*# 	0.046085, 0.089983, 0.089983, 0.104616, 0.058580, 0.050496, 0.048326, 0.083498, 0.058580, 0.053697, 0.058590, 0.044542, 0.053192, 0.054265, 0.092398, 0.075367, 0.094890, 0.136655, 0.063976
#*# 	0.071428, 0.086021, 0.089855, 0.104453, 0.092312, 0.063352, 0.063414, 0.061205, 0.030782, 0.047166, 0.035801, 0.047166, 0.058470, 0.061174, 0.062288, 0.060637, 0.121334, 0.128930, 0.046062
#*# 	0.049451, 0.103053, 0.074689, 0.087652, 0.095482, 0.070343, 0.051955, 0.070343, 0.042235, 0.048703, 0.050355, 0.055166, 0.053627, 0.038980, 0.058748, 0.060889, 0.064680, 0.115156, 0.053323
#*# 	0.042719, 0.114786, 0.054089, 0.067056, 0.063845, 0.064384, 0.043834, 0.052479, 0.042722, 0.032318, 0.021514, 0.031251, 0.037761, 0.040482, 0.055059, 0.063214, 0.087172, 0.090380, 0.038204
#*# 	0.079531, 0.067252, 0.054812, 0.064578, 0.074599, 0.049956, 0.054821, 0.058032, 0.008956, 0.011480, 0.034350, 0.033236, 0.034374, 0.034303, 0.040867, 0.048397, 0.051646, 0.080464, 0.027017
#*# 	0.059602, 0.103648, 0.083359, 0.066586, 0.064446, 0.046648, 0.027635, 0.030060, 0.006427, -0.020422, -0.011520, 0.000647, -0.004190, 0.003166, -0.029510, 0.029252, 0.033878, 0.051156, 0.007440
#*# 	0.064452, 0.075622, 0.048462, 0.044673, 0.049493, 0.024472, 0.026209, 0.000096, 0.000087, -0.022907, -0.009686, -0.004755, -0.011456, -0.036615, 0.001632, -0.023939, 0.021116, 0.032102, -0.033027
#*# 	0.033568, 0.050542, 0.052132, 0.016295, 0.028477, -0.034893, -0.037579, -0.028540, -0.048362, -0.054642, -0.060338, -0.085293, -0.061303, -0.076679, -0.047953, -0.041542, -0.041557, 0.004508, -0.044218
#*# 	0.053073, 0.012751, -0.017923, 0.003142, -0.052099, -0.054677, -0.048456, -0.085328, -0.128881, -0.116320, -0.117880, -0.101357, -0.099018, -0.101357, -0.100581, -0.076433, -0.078962, -0.053407, -0.094349
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 57.0
#*# shaper_type_y = ei
#*# shaper_freq_y = 61.2
