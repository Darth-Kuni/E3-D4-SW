# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
#[include lcd.cfg]
#[include lights.cfg]

#[mcu]
#serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_39003D001950425938323120-if00 #/dev/serial/by-id/usb-Klipper_stm32g0b1xx_hurakan-if00

[mcu]
canbus_uuid: 4fbce31db688 #4fbce31db688 uuid=4fbce31db688
canbus_interface: can0

[force_move]
enable_force_move: True 

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1000
max_z_velocity: 50
max_z_accel: 1000
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
microsteps: 16
rotation_distance: 40
endstop_pin: EBBCan:gpio24 #!PD3
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
microsteps: 16
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
microsteps: 16
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
#position_endstop: 0
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#[extruder]
#step_pin: PB12
#dir_pin: !PB11
#enable_pin: !PA8
#microsteps: 16
#rotation_distance: 33.500
#nozzle_diameter: 0.400
#filament_diameter: 1.750
#heater_pin: PC5
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: PA1
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
#min_temp: 0
#max_temp: 300

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

#####################################################################
#   Homing and Bed Mesh
#####################################################################
#[homing_override]
#axes: z
#set_position_z: 0
#gcode:
#    G90
#    G0 Z5 F500
#    G28 X0 Y0
#    G0 X125 Y100 F9000
#    G28 Z0
#    G0 Z5 F500

#[bed_mesh]
#speed: 150
#horizontal_move_z: 5
#mesh_min: 25,35.0
#mesh_max: 225.0,220
#probe_count: 7,7
#algorithm: bicubic
#fade_start: 1
#fade_end: 10
#fade_target: 0

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 35.448
#*# pid_ki = 13.129
#*# pid_kd = 23.927
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3215946.972,0.087500:3215299.281,0.131250:3214493.793,
#*# 	0.168750:3213835.575,0.212500:3213061.402,0.250000:3212391.944,
#*# 	0.287500:3211733.978,0.331250:3210960.789,0.368750:3210321.808,
#*# 	0.412500:3209564.557,0.450000:3208994.669,0.487500:3208412.028,
#*# 	0.531250:3207780.229,0.568750:3207253.727,0.612500:3206561.267,
#*# 	0.650000:3206061.375,0.687500:3205526.978,0.731250:3204947.589,
#*# 	0.768750:3204392.543,0.812500:3203715.477,0.850000:3203229.541,
#*# 	0.887500:3202746.732,0.931250:3202178.782,0.968750:3201724.989,
#*# 	1.012500:3201160.474,1.050000:3200701.211,1.087500:3200297.628,
#*# 	1.131250:3199767.412,1.168750:3199348.174,1.212500:3198789.175,
#*# 	1.250000:3198385.005,1.287500:3197956.254,1.331250:3197499.005,
#*# 	1.368750:3197120.052,1.412500:3196689.633,1.450000:3196309.519,
#*# 	1.487500:3195942.858,1.531250:3195540.248,1.568750:3195165.800,
#*# 	1.612500:3194739.997,1.650000:3194380.822,1.687500:3194041.193,
#*# 	1.731250:3193631.187,1.768750:3193274.730,1.812500:3192904.063,
#*# 	1.850000:3192590.491,1.887500:3192265.851,1.931250:3191916.529,
#*# 	1.968750:3191620.431,2.012500:3191261.118,2.050000:3190964.064,
#*# 	2.087500:3190643.544,2.131250:3190347.390,2.168750:3190063.391,
#*# 	2.212500:3189742.986,2.250000:3189480.433,2.287500:3189222.181,
#*# 	2.331250:3188920.410,2.368750:3188660.646,2.412500:3188339.185,
#*# 	2.450000:3188073.270,2.487500:3187847.232,2.531250:3187588.193,
#*# 	2.568750:3187339.761,2.612500:3187076.209,2.650000:3186857.600,
#*# 	2.687500:3186632.420,2.731250:3186366.379,2.768750:3186181.750,
#*# 	2.812500:3185898.709,2.850000:3185712.596,2.887500:3185505.092,
#*# 	2.931250:3185250.301,2.968750:3185083.831,3.012500:3184845.702,
#*# 	3.050000:3184681.229,3.087500:3184479.488,3.131250:3184285.024,
#*# 	3.168750:3184117.717,3.212500:3183874.229,3.250000:3183672.867,
#*# 	3.287500:3183517.302,3.331250:3183299.607,3.368750:3183125.675,
#*# 	3.412500:3182918.766,3.450000:3182771.001,3.487500:3182607.411,
#*# 	3.531250:3182418.561,3.568750:3182276.251,3.612500:3182080.833,
#*# 	3.650000:3181941.565,3.687500:3181799.887,3.731250:3181598.630,
#*# 	3.768750:3181452.502,3.812500:3181290.891,3.850000:3181169.595,
#*# 	3.887500:3181010.143,3.931250:3180878.406,3.968750:3180755.258,
#*# 	4.012500:3180589.260,4.050000:3180467.598
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 32.015903
