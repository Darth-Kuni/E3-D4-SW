# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[mcu]
canbus_uuid: 4fbce31db688 
canbus_interface: can0

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include LCD.cfg]
[include klipperExpander.cfg]
[include lights.cfg]
#[include Knomi.cfg]
#[include lights.cfg]

[exclude_object]

[input_shaper]
#shaper_freq_x: ...
#shaper_type_x: ...
#shaper_freq_y: 34.6
#shaper_type_y: mzv

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 
position_endstop: 0
position_max: 220
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 57.0
#*# shaper_type_y = ei
#*# shaper_freq_y = 61.2
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3202004.045,0.087500:3201966.222,0.131250:3201944.003,
#*# 	0.168750:3201934.122,0.212500:3201865.710,0.250000:3201804.262,
#*# 	0.287500:3201699.288,0.331250:3201556.517,0.368750:3201445.044,
#*# 	0.412500:3201293.804,0.450000:3201204.892,0.487500:3201092.062,
#*# 	0.531250:3200942.440,0.568750:3200816.348,0.612500:3200690.873,
#*# 	0.650000:3200579.558,0.687500:3200466.481,0.731250:3200359.862,
#*# 	0.768750:3200233.054,0.812500:3200121.052,0.850000:3200007.224,
#*# 	0.887500:3199908.083,0.931250:3199789.388,0.968750:3199674.910,
#*# 	1.012500:3199532.533,1.050000:3199451.507,1.087500:3199354.736,
#*# 	1.131250:3199246.861,1.168750:3199155.625,1.212500:3199063.756,
#*# 	1.250000:3198916.447,1.287500:3198886.280,1.331250:3198778.676,
#*# 	1.368750:3198684.750,1.412500:3198583.496,1.450000:3198488.363,
#*# 	1.487500:3198406.573,1.531250:3198312.870,1.568750:3198232.319,
#*# 	1.612500:3198122.939,1.650000:3198066.822,1.687500:3197988.090,
#*# 	1.731250:3197891.617,1.768750:3197813.573,1.812500:3197721.073,
#*# 	1.850000:3197659.263,1.887500:3197569.517,1.931250:3197484.301,
#*# 	1.968750:3197416.955,2.012500:3197353.674,2.050000:3197260.456,
#*# 	2.087500:3197206.693,2.131250:3197131.870,2.168750:3197046.233,
#*# 	2.212500:3196970.349,2.250000:3196898.966,2.287500:3196830.597,
#*# 	2.331250:3196765.130,2.368750:3196698.523,2.412500:3196643.358,
#*# 	2.450000:3196606.114,2.487500:3196469.944,2.531250:3196434.861,
#*# 	2.568750:3196384.274,2.612500:3196295.698,2.650000:3196241.807,
#*# 	2.687500:3196189.737,2.731250:3196118.520,2.768750:3196086.327,
#*# 	2.812500:3196016.192,2.850000:3195964.029,2.887500:3195914.449,
#*# 	2.931250:3195849.563,2.968750:3195788.684,3.012500:3195689.365,
#*# 	3.050000:3195658.668,3.087500:3195609.277,3.131250:3195553.949,
#*# 	3.168750:3195522.147,3.212500:3195458.991,3.250000:3195405.416,
#*# 	3.287500:3195355.845,3.331250:3195310.673,3.368750:3195253.841,
#*# 	3.412500:3195181.360,3.450000:3195149.688,3.487500:3195096.300,
#*# 	3.531250:3195053.059,3.568750:3195007.885,3.612500:3194955.348,
#*# 	3.650000:3194932.305,3.687500:3194880.415,3.731250:3194830.953,
#*# 	3.768750:3194770.940,3.812500:3194729.779,3.850000:3194680.004,
#*# 	3.887500:3194658.761,3.931250:3194604.665,3.968750:3194569.201,
#*# 	4.012500:3194514.742,4.050000:3194487.758
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 41.460392
#*# drift_calibration =
#*# 	3210270.985112, -266.588152, 1.116138
#*# 	3206554.378854, -177.953257, 0.323198
#*# 	3204416.557038, -145.709242, 0.060458
#*# 	3202552.077956, -116.440989, -0.181757
#*# 	3201295.408854, -105.347403, -0.252816
#*# 	3199786.131692, -77.958033, -0.488171
#*# 	3198782.384243, -64.672813, -0.605395
#*# 	3197901.839244, -54.286773, -0.685088
#*# 	3197174.216089, -46.669659, -0.736806
#*# drift_calibration_min_temp = 34.86621262956116
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.031536, -0.029465, -0.006812, 0.014392, 0.001736, -0.019903, -0.029465, -0.037605, -0.104666, -0.102983, -0.046870, -0.048732, -0.045983, -0.046964, -0.034167, -0.049168, -0.098548, -0.017836, -0.106864
#*# 	0.000367, 0.052618, 0.041119, 0.029098, 0.021686, -0.000605, -0.028360, -0.032484, -0.042040, -0.048809, -0.048809, -0.067442, -0.056211, -0.046831, -0.038598, -0.025847, -0.005174, -0.005174, -0.110115
#*# 	0.030970, 0.024181, 0.059624, 0.038065, 0.055062, 0.018649, -0.013208, -0.013356, -0.029824, -0.036106, -0.019732, -0.040614, -0.036106, -0.037429, -0.043017, -0.016978, -0.016096, 0.001080, -0.088855
#*# 	0.071613, 0.083680, 0.079895, 0.072534, 0.042689, 0.027737, -0.016729, -0.013538, -0.027221, -0.046210, -0.039439, -0.073773, -0.031885, -0.030562, -0.029240, -0.016881, 0.012353, 0.017570, -0.093315
#*# 	0.083242, 0.092099, 0.085893, 0.069377, 0.041181, 0.009286, 0.019563, -0.013517, -0.077030, -0.035394, -0.019988, -0.024991, -0.030439, -0.031762, -0.018078, -0.035278, -0.006654, 0.006277, -0.083675
#*# 	0.111007, 0.126047, 0.150600, 0.111185, 0.072418, 0.029219, 0.044385, -0.020077, -0.018746, -0.015959, -0.043329, -0.039211, -0.039203, -0.001080, -0.017698, -0.018675, 0.028668, 0.020286, -0.074504
#*# 	0.076420, 0.125946, 0.114134, 0.114842, 0.116577, 0.069933, 0.016249, 0.056814, 0.002480, -0.014409, -0.012640, -0.026280, -0.020394, -0.040713, -0.005554, -0.002798, -0.009599, 0.020067, -0.087909
#*# 	0.104195, 0.173152, 0.139661, 0.120673, 0.092725, 0.072852, 0.040777, 0.017669, -0.000229, -0.027878, 0.020161, -0.034651, -0.020963, -0.023759, -0.010694, 0.009875, 0.032407, 0.023972, -0.049496
#*# 	0.130179, 0.140767, 0.131920, 0.138529, 0.117480, 0.102872, 0.079249, 0.042079, -0.000774, -0.002426, -0.020864, -0.031750, -0.035055, -0.019901, 0.004227, 0.014429, 0.009205, 0.006718, -0.117773
#*# 	0.146144, 0.179245, 0.144819, 0.134162, 0.122484, 0.069644, 0.022724, 0.007128, 0.005653, -0.022286, -0.010424, -0.020962, -0.020962, -0.012722, -0.000220, 0.004999, 0.012447, -0.010438, -0.048104
#*# 	0.151501, 0.167799, 0.142842, 0.124546, 0.116583, 0.090794, 0.076218, 0.029425, 0.008300, 0.011613, 0.005738, -0.006945, 0.015915, -0.030008, 0.015929, 0.008216, 0.011780, 0.039502, -0.061747
#*# 	0.105334, 0.143545, 0.157752, 0.127948, 0.139768, 0.100988, 0.038265, 0.043754, 0.040098, 0.012824, -0.031715, -0.014970, -0.016294, -0.017618, -0.014970, 0.011000, 0.007594, 0.021237, -0.096154
#*# 	0.163824, 0.174422, 0.158384, 0.150623, 0.138350, 0.077162, 0.071452, 0.045687, 0.017893, 0.012750, 0.007607, -0.000112, -0.010319, -0.012659, 0.009348, 0.004390, 0.006038, 0.009348, -0.104549
#*# 	0.155256, 0.187258, 0.161166, 0.125272, 0.139926, 0.071653, 0.053070, 0.012619, 0.012638, 0.007652, -0.010258, -0.012627, -0.035907, -0.019554, -0.032783, -0.021735, -0.006906, 0.011018, -0.063626
#*# 	0.150410, 0.163897, 0.147840, 0.174913, 0.150809, 0.082928, 0.056793, 0.038129, 0.005870, -0.012612, -0.020904, -0.010306, -0.033950, -0.014647, -0.025690, -0.027022, -0.001351, -0.001351, -0.088923
#*# 	0.155068, 0.190480, 0.151195, 0.118177, 0.105766, 0.087424, 0.050619, -0.004876, -0.004876, -0.013041, -0.018503, -0.025276, -0.022626, -0.025276, -0.018503, -0.018355, -0.010122, 0.000167, -0.090557
#*# 	0.190205, 0.139828, 0.093893, 0.134611, 0.116218, 0.088266, 0.032419, 0.038100, -0.009602, -0.017342, -0.015378, -0.039888, -0.033108, -0.031775, -0.015431, 0.015393, -0.026283, -0.016756, -0.095824
#*# 	0.142817, 0.144207, 0.096011, 0.083190, 0.116532, 0.051727, 0.004391, -0.010879, -0.031307, -0.029982, -0.053559, -0.017604, -0.043686, -0.089212, -0.040887, -0.025851, -0.017604, -0.011376, -0.099594
#*# 	0.117128, 0.091392, 0.057429, 0.033968, 0.015699, 0.007237, -0.041156, -0.088831, -0.059781, -0.092960, -0.113841, -0.088181, -0.138940, -0.111566, -0.109304, -0.127935, -0.048626, -0.107042, -0.145767
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
