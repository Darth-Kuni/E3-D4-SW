# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[mcu]
canbus_uuid: 4fbce31db688 
canbus_interface: can0

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include LCD.cfg]
[include klipperExpander.cfg]
[include lights.cfg]
[include KAMP_Settings.cfg]
#[include lights.cfg]

[exclude_object]

[input_shaper]

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 
position_endstop: 0
position_max: 220
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 57.0
#*# shaper_type_y = ei
#*# shaper_freq_y = 61.2
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3204078.248,0.087500:3204076.640,0.131250:3204015.801,
#*# 	0.168750:3203894.243,0.212500:3203755.122,0.250000:3203630.354,
#*# 	0.287500:3203520.589,0.331250:3203371.675,0.368750:3203265.425,
#*# 	0.412500:3203126.578,0.450000:3203040.345,0.487500:3202881.347,
#*# 	0.531250:3202756.235,0.568750:3202594.412,0.612500:3202509.232,
#*# 	0.650000:3202409.515,0.687500:3202265.902,0.731250:3202167.717,
#*# 	0.768750:3202109.984,0.812500:3201961.782,0.850000:3201862.333,
#*# 	0.887500:3201760.282,0.931250:3201601.610,0.968750:3201517.213,
#*# 	1.012500:3201399.112,1.050000:3201292.360,1.087500:3201208.531,
#*# 	1.131250:3201102.233,1.168750:3201021.710,1.212500:3200916.552,
#*# 	1.250000:3200844.047,1.287500:3200740.498,1.331250:3200622.640,
#*# 	1.368750:3200530.350,1.412500:3200436.708,1.450000:3200355.270,
#*# 	1.487500:3200269.321,1.531250:3200150.004,1.568750:3200098.738,
#*# 	1.612500:3199999.682,1.650000:3199892.016,1.687500:3199812.028,
#*# 	1.731250:3199725.095,1.768750:3199630.598,1.812500:3199545.979,
#*# 	1.850000:3199472.746,1.887500:3199400.278,1.931250:3199335.705,
#*# 	1.968750:3199256.442,2.012500:3199184.800,2.050000:3199119.197,
#*# 	2.087500:3199027.134,2.131250:3198957.476,2.168750:3198883.342,
#*# 	2.212500:3198809.810,2.250000:3198731.450,2.287500:3198683.912,
#*# 	2.331250:3198609.583,2.368750:3198534.956,2.412500:3198464.092,
#*# 	2.450000:3198411.714,2.487500:3198341.052,2.531250:3198263.322,
#*# 	2.568750:3198202.910,2.612500:3198138.351,2.650000:3198069.778,
#*# 	2.687500:3198030.701,2.731250:3197952.992,2.768750:3197901.821,
#*# 	2.812500:3197858.827,2.850000:3197796.181,2.887500:3197739.753,
#*# 	2.931250:3197675.681,2.968750:3197610.848,3.012500:3197549.216,
#*# 	3.050000:3197495.192,3.087500:3197451.074,3.131250:3197391.351,
#*# 	3.168750:3197351.373,3.212500:3197294.565,3.250000:3197239.958,
#*# 	3.287500:3197188.983,3.331250:3197111.884,3.368750:3197080.031,
#*# 	3.412500:3197048.585,3.450000:3196995.072,3.487500:3196946.448,
#*# 	3.531250:3196892.406,3.568750:3196851.132,3.612500:3196803.626,
#*# 	3.650000:3196756.275,3.687500:3196709.994,3.731250:3196673.434,
#*# 	3.768750:3196618.161,3.812500:3196560.434,3.850000:3196526.114,
#*# 	3.887500:3196478.752,3.931250:3196450.837,3.968750:3196397.979,
#*# 	4.012500:3196365.257,4.050000:3196331.202
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 41.173301
#*# drift_calibration =
#*# 	3210270.985112, -266.588152, 1.116138
#*# 	3206554.378854, -177.953257, 0.323198
#*# 	3204416.557038, -145.709242, 0.060458
#*# 	3202552.077956, -116.440989, -0.181757
#*# 	3201295.408854, -105.347403, -0.252816
#*# 	3199786.131692, -77.958033, -0.488171
#*# 	3198782.384243, -64.672813, -0.605395
#*# 	3197901.839244, -54.286773, -0.685088
#*# 	3197174.216089, -46.669659, -0.736806
#*# drift_calibration_min_temp = 34.86621262956116
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.038418, -0.004925, -0.005806, 0.053371, 0.045060, 0.030439, -0.036959, -0.022441, -0.048966, -0.070132, -0.053357, -0.057488, -0.047194, -0.048771, -0.026287, -0.007225, 0.006752, 0.016024, -0.018243
#*# 	0.047428, 0.095580, 0.057565, 0.035374, 0.076573, 0.039099, 0.003037, -0.016431, -0.035705, -0.034320, -0.036695, -0.043951, -0.069914, -0.032647, -0.027800, -0.039166, 0.034323, 0.005886, -0.002519
#*# 	0.073254, 0.051734, 0.092393, 0.129321, 0.089929, 0.054777, 0.026683, 0.008130, -0.036072, -0.023299, -0.019994, -0.015102, -0.082634, -0.024741, 0.011336, 0.019048, 0.039719, 0.050776, -0.011287
#*# 	0.078318, 0.111583, 0.132776, 0.120581, 0.113216, 0.067359, 0.029054, 0.019889, 0.001333, -0.010363, -0.012660, -0.012647, -0.014331, -0.041728, 0.001206, 0.024471, 0.057937, 0.062627, -0.023304
#*# 	0.130361, 0.068958, 0.128141, 0.108559, 0.128021, 0.039522, 0.041331, 0.054151, 0.022761, 0.005030, -0.011962, -0.011962, -0.004263, 0.009741, 0.026011, 0.047110, 0.059133, 0.030595, 0.004674
#*# 	0.108218, 0.149674, 0.164859, 0.148199, 0.125411, 0.098081, 0.061334, 0.044661, -0.014048, 0.013907, -0.010849, -0.022856, 0.010955, 0.001660, 0.018578, 0.017143, 0.077525, 0.077438, 0.010955
#*# 	0.154333, 0.169289, 0.161929, 0.182427, 0.126790, 0.112051, 0.062814, 0.048068, 0.014420, 0.030706, -0.001861, 0.028413, 0.015957, 0.022431, 0.016231, 0.016227, 0.060328, 0.048419, 0.003850
#*# 	0.131953, 0.204870, 0.194405, 0.151868, 0.171575, 0.127078, 0.091768, 0.071066, 0.039374, 0.001685, 0.024973, -0.012176, -0.005267, -0.000689, 0.033924, 0.054215, 0.075298, 0.081539, -0.016272
#*# 	0.187070, 0.194098, 0.190666, 0.195336, 0.175841, 0.133339, 0.043405, 0.063698, 0.023615, 0.005032, 0.038730, -0.030523, 0.023624, -0.001957, 0.062773, 0.042472, 0.077884, 0.072503, -0.000939
#*# 	0.172578, 0.195121, 0.211318, 0.195699, 0.166312, 0.143009, 0.080158, 0.055259, 0.052392, 0.052376, -0.011348, 0.016579, 0.007154, -0.009057, 0.004826, 0.057991, 0.059867, 0.060273, 0.007593
#*# 	0.201993, 0.198247, 0.179617, 0.210441, 0.197109, 0.124273, 0.100115, 0.107258, 0.076318, 0.049797, 0.035044, 0.044254, 0.034954, 0.040565, 0.054364, 0.032216, 0.074721, 0.044244, 0.003365
#*# 	0.211408, 0.208389, 0.209566, 0.210717, 0.201444, 0.159352, 0.109248, 0.057552, 0.067755, 0.058554, 0.038239, 0.042479, 0.003354, 0.031412, 0.044347, 0.055369, 0.087429, 0.084245, 0.003493
#*# 	0.201584, 0.218363, 0.192254, 0.195771, 0.205715, 0.152208, 0.132317, 0.072124, 0.061541, 0.055921, 0.031087, 0.050468, 0.019394, 0.041207, 0.037620, 0.030445, 0.083312, 0.078604, 0.000097
#*# 	0.226891, 0.250574, 0.228037, 0.214144, 0.201941, 0.168580, 0.094634, 0.102072, 0.066782, 0.064958, 0.048276, 0.042807, 0.019201, 0.035413, 0.016138, 0.051147, 0.045526, 0.050191, -0.000614
#*# 	0.211592, 0.211592, 0.145398, 0.201158, 0.198809, 0.147820, 0.115955, 0.096782, 0.049821, 0.035157, 0.068446, 0.055390, 0.030613, 0.030613, 0.026701, 0.051656, 0.062883, 0.052669, -0.007590
#*# 	0.215484, 0.237823, 0.194581, 0.204080, 0.197148, 0.142232, 0.100007, 0.050589, 0.042242, 0.047701, 0.028023, 0.026405, -0.003023, 0.017136, 0.017136, 0.013317, 0.042288, 0.094426, 0.017229
#*# 	0.216631, 0.206121, 0.155741, 0.175344, 0.153842, 0.107596, 0.094854, 0.074981, 0.053817, 0.030539, 0.036021, 0.029057, -0.002092, 0.016638, 0.036016, 0.036031, 0.034205, 0.049841, -0.040468
#*# 	0.152810, 0.200992, 0.198603, 0.181061, 0.124016, 0.118283, 0.065025, 0.039939, 0.002855, -0.004890, -0.017500, 0.031739, -0.005746, 0.001423, -0.000204, -0.003680, 0.016484, 0.037772, -0.024336
#*# 	0.205670, 0.161310, 0.139419, 0.134568, 0.112370, 0.071800, 0.030613, 0.019048, -0.039512, -0.030586, -0.028195, -0.033109, -0.043046, -0.039770, -0.031719, -0.019687, 0.001513, -0.004599, -0.046217
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
