# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include macro (2).cfg]
[include klipperExpander.cfg]
[include lights.cfg]
#[include lights.cfg]
#[include lights.cfg]

[mcu]
canbus_uuid: 4fbce31db688 #4fbce31db688 uuid=4fbce31db688
canbus_interface: can0

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 #!PD3
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#[extruder]
#step_pin: PB12
#dir_pin: !PB11
#enable_pin: !PA8
#microsteps: 16
#rotation_distance: 33.500
#nozzle_diameter: 0.400
#filament_diameter: 1.750
#heater_pin: PC5
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: PA1
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
#min_temp: 0
#max_temp: 300

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

#####################################################################
#   Homing and Bed Mesh
#####################################################################
#[homing_override]
#axes: z
#set_position_z: 0
#gcode:
#    G90
#    G0 Z5 F500
#    G28 X0 Y0
#    G0 X125 Y100 F9000
#    G28 Z0
#    G0 Z5 F500

#[bed_mesh]
#speed: 150
#horizontal_move_z: 5
#mesh_min: 25,35.0
#mesh_max: 225.0,220
#probe_count: 7,7
#algorithm: bicubic
#fade_start: 1
#fade_end: 10
#fade_target: 0

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3215212.557,0.087500:3214594.543,0.131250:3213829.587,
#*# 	0.168750:3213190.522,0.212500:3212486.404,0.250000:3211830.208,
#*# 	0.287500:3211193.933,0.331250:3210381.038,0.368750:3209676.409,
#*# 	0.412500:3208915.090,0.450000:3208299.293,0.487500:3207721.235,
#*# 	0.531250:3207038.913,0.568750:3206502.486,0.612500:3205907.628,
#*# 	0.650000:3205391.116,0.687500:3204843.301,0.731250:3204251.047,
#*# 	0.768750:3203681.629,0.812500:3203086.549,0.850000:3202590.262,
#*# 	0.887500:3202074.209,0.931250:3201517.569,0.968750:3201091.089,
#*# 	1.012500:3200616.081,1.050000:3200186.328,1.087500:3199696.546,
#*# 	1.131250:3199148.070,1.168750:3198702.248,1.212500:3198170.144,
#*# 	1.250000:3197720.427,1.287500:3197299.093,1.331250:3196849.441,
#*# 	1.368750:3196500.344,1.412500:3196074.352,1.450000:3195723.489,
#*# 	1.487500:3195353.535,1.531250:3194909.324,1.568750:3194533.484,
#*# 	1.612500:3194110.895,1.650000:3193740.808,1.687500:3193414.101,
#*# 	1.731250:3192995.166,1.768750:3192694.403,1.812500:3192364.538,
#*# 	1.850000:3192059.437,1.887500:3191753.663,1.931250:3191356.797,
#*# 	1.968750:3191048.083,2.012500:3190710.599,2.050000:3190389.102,
#*# 	2.087500:3190106.148,2.131250:3189778.492,2.168750:3189527.911,
#*# 	2.212500:3189212.796,2.250000:3188978.972,2.287500:3188695.078,
#*# 	2.331250:3188356.760,2.368750:3188089.547,2.412500:3187822.767,
#*# 	2.450000:3187561.352,2.487500:3187317.848,2.531250:3187037.226,
#*# 	2.568750:3186842.693,2.612500:3186607.324,2.650000:3186391.223,
#*# 	2.687500:3186154.679,2.731250:3185885.740,2.768750:3185658.144,
#*# 	2.812500:3185386.416,2.850000:3185174.350,2.887500:3184955.027,
#*# 	2.931250:3184701.096,2.968750:3184521.438,3.012500:3184305.938,
#*# 	3.050000:3184122.335,3.087500:3183940.131,3.131250:3183730.608,
#*# 	3.168750:3183530.357,3.212500:3183307.439,3.250000:3183124.505,
#*# 	3.287500:3182946.421,3.331250:3182751.426,3.368750:3182598.554,
#*# 	3.412500:3182419.867,3.450000:3182266.003,3.487500:3182112.631,
#*# 	3.531250:3181935.427,3.568750:3181760.193,3.612500:3181558.598,
#*# 	3.650000:3181398.169,3.687500:3181255.989,3.731250:3181107.654,
#*# 	3.768750:3180985.302,3.812500:3180816.083,3.850000:3180687.379,
#*# 	3.887500:3180541.343,3.931250:3180361.612,3.968750:3180233.985,
#*# 	4.012500:3180082.043,4.050000:3179964.781
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 42.153212
#*# drift_calibration =
#*# 	3154445.514308, 2382.100157, -23.614725
#*# 	3155546.578189, 2016.455741, -20.019858
#*# 	3157546.363919, 1681.566529, -16.776092
#*# 	3161842.134872, 1311.119022, -13.228808
#*# 	3162328.395744, 1129.898925, -11.481792
#*# 	3162827.089072, 979.506886, -10.036339
#*# 	3163810.595322, 836.048852, -8.688770
#*# 	3165848.239680, 666.575209, -7.042320
#*# 	3165967.231164, 587.278070, -6.253735
#*# drift_calibration_min_temp = 38.10773614234867
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.055962, 0.063080, 0.066977, 0.091715, 0.094825, 0.087755, 0.097940, 0.100580, 0.080184, 0.077332, 0.082636, 0.099472, 0.110671, 0.123633, 0.150257, 0.168555, 0.215566, 0.262618, 0.310606
#*# 	  0.147293, 0.137619, 0.121591, 0.115428, 0.111100, 0.097379, 0.104236, 0.097587, 0.089287, 0.082496, 0.078487, 0.105580, 0.107276, 0.124185, 0.147843, 0.169997, 0.210228, 0.247568, 0.296371
#*# 	  0.169703, 0.137637, 0.126438, 0.134046, 0.125496, 0.126780, 0.133233, 0.126780, 0.100513, 0.086976, 0.094661, 0.108686, 0.120608, 0.146254, 0.162700, 0.166643, 0.197382, 0.242978, 0.295138
#*# 	  0.204307, 0.192227, 0.157576, 0.147253, 0.146912, 0.125204, 0.122897, 0.118621, 0.095874, 0.095874, 0.092339, 0.104405, 0.121953, 0.126489, 0.142897, 0.165587, 0.202990, 0.235076, 0.275785
#*# 	  0.232284, 0.180320, 0.162030, 0.160533, 0.152651, 0.142785, 0.150678, 0.140847, 0.109136, 0.097190, 0.097447, 0.114841, 0.114736, 0.124560, 0.151144, 0.161839, 0.187539, 0.213851, 0.266332
#*# 	  0.251625, 0.235077, 0.200705, 0.176985, 0.169052, 0.137497, 0.143947, 0.130579, 0.107895, 0.103067, 0.092288, 0.109395, 0.116439, 0.126272, 0.144594, 0.155409, 0.193414, 0.223778, 0.244773
#*# 	  0.259349, 0.219923, 0.183656, 0.189704, 0.179140, 0.166842, 0.163765, 0.154569, 0.122371, 0.103630, 0.107162, 0.118360, 0.115134, 0.127982, 0.144074, 0.146511, 0.172197, 0.188703, 0.235649
#*# 	  0.280918, 0.260943, 0.223723, 0.201755, 0.179434, 0.154293, 0.147532, 0.127511, 0.107663, 0.106318, 0.095219, 0.106318, 0.111196, 0.117968, 0.130394, 0.143599, 0.178106, 0.196184, 0.219747
#*# 	  0.292580, 0.244609, 0.213372, 0.202372, 0.186786, 0.174548, 0.152875, 0.156342, 0.120294, 0.105704, 0.103433, 0.109205, 0.104329, 0.118661, 0.125738, 0.132029, 0.146125, 0.174380, 0.215510
#*# 	  0.303991, 0.280512, 0.244748, 0.217380, 0.196609, 0.161693, 0.150504, 0.139184, 0.113004, 0.100587, 0.089374, 0.103838, 0.102942, 0.108159, 0.119073, 0.127957, 0.146979, 0.157795, 0.194949
#*# 	  0.297833, 0.264092, 0.227985, 0.222121, 0.199920, 0.166708, 0.167340, 0.155703, 0.120631, 0.097267, 0.098022, 0.105981, 0.100657, 0.102143, 0.113418, 0.118369, 0.139514, 0.149367, 0.185292
#*# 	  0.324721, 0.298045, 0.260495, 0.220422, 0.201610, 0.170063, 0.153831, 0.141012, 0.115414, 0.097625, 0.096729, 0.089663, 0.101604, 0.098498, 0.108223, 0.113664, 0.129125, 0.147702, 0.168567
#*# 	  0.324282, 0.264521, 0.240607, 0.219723, 0.202719, 0.174425, 0.171433, 0.153514, 0.114416, 0.090931, 0.091776, 0.096231, 0.093543, 0.094489, 0.101554, 0.101529, 0.105062, 0.124637, 0.150770
#*# 	  0.319658, 0.296928, 0.251951, 0.216356, 0.205727, 0.164552, 0.150216, 0.137796, 0.097301, 0.086705, 0.083174, 0.083597, 0.085645, 0.075281, 0.086821, 0.097301, 0.102603, 0.117734, 0.133819
#*# 	  0.320271, 0.259739, 0.224244, 0.211980, 0.188916, 0.161821, 0.161846, 0.133764, 0.100180, 0.081881, 0.073923, 0.075829, 0.069048, 0.065654, 0.066669, 0.071685, 0.080307, 0.085860, 0.109737
#*# 	  0.312537, 0.289897, 0.237428, 0.196856, 0.179634, 0.147133, 0.128093, 0.102565, 0.083565, 0.065069, 0.052042, 0.053342, 0.054308, 0.054776, 0.051346, 0.053321, 0.070384, 0.082206, 0.085738
#*# 	  0.311724, 0.245645, 0.203761, 0.186773, 0.153143, 0.136947, 0.131290, 0.104006, 0.068921, 0.049398, 0.041616, 0.047143, 0.030550, 0.029494, 0.033836, 0.034879, 0.035812, 0.056772, 0.078834
#*# 	  0.319501, 0.275646, 0.231257, 0.181319, 0.164043, 0.115209, 0.095932, 0.087882, 0.048667, 0.030790, 0.016723, 0.025119, 0.020874, 0.014843, 0.002984, 0.007528, 0.030263, 0.028686, 0.064608
#*# 	  0.323911, 0.244285, 0.201090, 0.182561, 0.143162, 0.108628, 0.092237, 0.074150, 0.031417, 0.016863, 0.003487, 0.006061, -0.004322, -0.008506, -0.002248, -0.003299, -0.008473, 0.012378, 0.033377
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
