# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include macro (2).cfg]
[include klipperExpander.cfg]
[include lights.cfg]
#[include lights.cfg]
#[include lights.cfg]

[mcu]
canbus_uuid: 4fbce31db688 #4fbce31db688 uuid=4fbce31db688
canbus_interface: can0

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 #!PD3
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#[extruder]
#step_pin: PB12
#dir_pin: !PB11
#enable_pin: !PA8
#microsteps: 16
#rotation_distance: 33.500
#nozzle_diameter: 0.400
#filament_diameter: 1.750
#heater_pin: PC5
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: PA1
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
#min_temp: 0
#max_temp: 300

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

#####################################################################
#   Homing and Bed Mesh
#####################################################################
#[homing_override]
#axes: z
#set_position_z: 0
#gcode:
#    G90
#    G0 Z5 F500
#    G28 X0 Y0
#    G0 X125 Y100 F9000
#    G28 Z0
#    G0 Z5 F500

#[bed_mesh]
#speed: 150
#horizontal_move_z: 5
#mesh_min: 25,35.0
#mesh_max: 225.0,220
#probe_count: 7,7
#algorithm: bicubic
#fade_start: 1
#fade_end: 10
#fade_target: 0

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3215212.557,0.087500:3214594.543,0.131250:3213829.587,
#*# 	0.168750:3213190.522,0.212500:3212486.404,0.250000:3211830.208,
#*# 	0.287500:3211193.933,0.331250:3210381.038,0.368750:3209676.409,
#*# 	0.412500:3208915.090,0.450000:3208299.293,0.487500:3207721.235,
#*# 	0.531250:3207038.913,0.568750:3206502.486,0.612500:3205907.628,
#*# 	0.650000:3205391.116,0.687500:3204843.301,0.731250:3204251.047,
#*# 	0.768750:3203681.629,0.812500:3203086.549,0.850000:3202590.262,
#*# 	0.887500:3202074.209,0.931250:3201517.569,0.968750:3201091.089,
#*# 	1.012500:3200616.081,1.050000:3200186.328,1.087500:3199696.546,
#*# 	1.131250:3199148.070,1.168750:3198702.248,1.212500:3198170.144,
#*# 	1.250000:3197720.427,1.287500:3197299.093,1.331250:3196849.441,
#*# 	1.368750:3196500.344,1.412500:3196074.352,1.450000:3195723.489,
#*# 	1.487500:3195353.535,1.531250:3194909.324,1.568750:3194533.484,
#*# 	1.612500:3194110.895,1.650000:3193740.808,1.687500:3193414.101,
#*# 	1.731250:3192995.166,1.768750:3192694.403,1.812500:3192364.538,
#*# 	1.850000:3192059.437,1.887500:3191753.663,1.931250:3191356.797,
#*# 	1.968750:3191048.083,2.012500:3190710.599,2.050000:3190389.102,
#*# 	2.087500:3190106.148,2.131250:3189778.492,2.168750:3189527.911,
#*# 	2.212500:3189212.796,2.250000:3188978.972,2.287500:3188695.078,
#*# 	2.331250:3188356.760,2.368750:3188089.547,2.412500:3187822.767,
#*# 	2.450000:3187561.352,2.487500:3187317.848,2.531250:3187037.226,
#*# 	2.568750:3186842.693,2.612500:3186607.324,2.650000:3186391.223,
#*# 	2.687500:3186154.679,2.731250:3185885.740,2.768750:3185658.144,
#*# 	2.812500:3185386.416,2.850000:3185174.350,2.887500:3184955.027,
#*# 	2.931250:3184701.096,2.968750:3184521.438,3.012500:3184305.938,
#*# 	3.050000:3184122.335,3.087500:3183940.131,3.131250:3183730.608,
#*# 	3.168750:3183530.357,3.212500:3183307.439,3.250000:3183124.505,
#*# 	3.287500:3182946.421,3.331250:3182751.426,3.368750:3182598.554,
#*# 	3.412500:3182419.867,3.450000:3182266.003,3.487500:3182112.631,
#*# 	3.531250:3181935.427,3.568750:3181760.193,3.612500:3181558.598,
#*# 	3.650000:3181398.169,3.687500:3181255.989,3.731250:3181107.654,
#*# 	3.768750:3180985.302,3.812500:3180816.083,3.850000:3180687.379,
#*# 	3.887500:3180541.343,3.931250:3180361.612,3.968750:3180233.985,
#*# 	4.012500:3180082.043,4.050000:3179964.781
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 42.153212
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.204185, 0.180310, 0.186093, 0.190128, 0.199383, 0.181323, 0.188998, 0.180200, 0.153744, 0.151766, 0.153070, 0.175609, 0.198676, 0.217414, 0.246367, 0.276695, 0.321181, 0.380504, 0.442294
#*# 	  0.297250, 0.264632, 0.238173, 0.220302, 0.207736, 0.182334, 0.176937, 0.169581, 0.144728, 0.139059, 0.139059, 0.149489, 0.164654, 0.180243, 0.218037, 0.249951, 0.302523, 0.353858, 0.414499
#*# 	  0.300775, 0.248975, 0.220302, 0.220634, 0.223095, 0.198011, 0.194191, 0.184473, 0.156984, 0.150775, 0.147316, 0.152393, 0.179211, 0.196457, 0.232120, 0.249394, 0.286450, 0.337012, 0.395389
#*# 	  0.326294, 0.297530, 0.253673, 0.237045, 0.226119, 0.194503, 0.173494, 0.178421, 0.136712, 0.128173, 0.125372, 0.140949, 0.167624, 0.174980, 0.200006, 0.228695, 0.273149, 0.317564, 0.366702
#*# 	  0.336572, 0.275969, 0.244801, 0.246838, 0.231704, 0.203207, 0.197742, 0.182807, 0.156039, 0.151449, 0.137844, 0.147924, 0.173967, 0.186723, 0.212907, 0.228891, 0.261779, 0.296384, 0.350148
#*# 	  0.362574, 0.330236, 0.280187, 0.251689, 0.240210, 0.203560, 0.186047, 0.175453, 0.145250, 0.133910, 0.127716, 0.138080, 0.140949, 0.158311, 0.174980, 0.214371, 0.250696, 0.286751, 0.330855
#*# 	  0.369412, 0.300742, 0.261917, 0.264075, 0.240766, 0.208712, 0.201918, 0.182807, 0.156355, 0.140970, 0.132932, 0.143363, 0.156355, 0.159255, 0.196455, 0.213376, 0.243061, 0.267084, 0.315155
#*# 	  0.380961, 0.347728, 0.295960, 0.256874, 0.242506, 0.206758, 0.189042, 0.178894, 0.148881, 0.129152, 0.116309, 0.130975, 0.132477, 0.147143, 0.166138, 0.187263, 0.225496, 0.261501, 0.293189
#*# 	  0.386093, 0.316947, 0.283257, 0.265188, 0.236730, 0.208710, 0.200319, 0.182853, 0.153069, 0.136538, 0.139583, 0.141470, 0.141927, 0.165667, 0.178423, 0.191595, 0.220614, 0.248975, 0.287015
#*# 	  0.395391, 0.362143, 0.306914, 0.268632, 0.248523, 0.213862, 0.189972, 0.175296, 0.141927, 0.131429, 0.112527, 0.120544, 0.129609, 0.132477, 0.166678, 0.171064, 0.208047, 0.242506, 0.275654
#*# 	  0.401709, 0.326294, 0.283679, 0.276536, 0.243654, 0.216127, 0.204806, 0.184111, 0.151135, 0.134367, 0.137169, 0.139059, 0.140037, 0.156355, 0.162698, 0.175927, 0.206447, 0.228831, 0.265779
#*# 	  0.413527, 0.372985, 0.309087, 0.279464, 0.260040, 0.221590, 0.196455, 0.176598, 0.147143, 0.121068, 0.116764, 0.119178, 0.123415, 0.130587, 0.148578, 0.158784, 0.196922, 0.230295, 0.252873
#*# 	  0.413938, 0.326913, 0.294636, 0.285003, 0.255447, 0.224518, 0.210311, 0.192549, 0.147316, 0.138800, 0.125302, 0.135800, 0.133389, 0.141016, 0.156828, 0.159795, 0.184473, 0.216769, 0.243931
#*# 	  0.420258, 0.377265, 0.323428, 0.284121, 0.261465, 0.219989, 0.200319, 0.181189, 0.137844, 0.123415, 0.112527, 0.115398, 0.114941, 0.120089, 0.126738, 0.143360, 0.176600, 0.210975, 0.231583
#*# 	  0.425304, 0.343494, 0.295907, 0.286167, 0.250540, 0.218350, 0.209957, 0.186407, 0.145250, 0.130063, 0.123412, 0.119635, 0.119178, 0.125829, 0.145253, 0.143360, 0.159277, 0.193993, 0.223542
#*# 	  0.433658, 0.384966, 0.324356, 0.280628, 0.253150, 0.214838, 0.199698, 0.165174, 0.132455, 0.113159, 0.099173, 0.100730, 0.096631, 0.100730, 0.104333, 0.122434, 0.150146, 0.182810, 0.216125
#*# 	  0.436938, 0.349845, 0.296806, 0.280345, 0.243931, 0.208357, 0.189040, 0.169401, 0.130496, 0.114419, 0.099742, 0.100730, 0.098188, 0.109987, 0.106877, 0.117288, 0.142232, 0.163708, 0.191616
#*# 	  0.445175, 0.398193, 0.330822, 0.277118, 0.253725, 0.208358, 0.178265, 0.151135, 0.120112, 0.098188, 0.083765, 0.084337, 0.083273, 0.074583, 0.081716, 0.096631, 0.128978, 0.155881, 0.187730
#*# 	  0.463255, 0.366701, 0.307763, 0.286767, 0.252003, 0.204804, 0.189662, 0.157838, 0.108926, 0.094582, 0.080731, 0.090484, 0.086386, 0.090484, 0.102779, 0.109495, 0.130063, 0.149490, 0.181797
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
