# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.

[mcu]
canbus_uuid: 4fbce31db688 
canbus_interface: can0

[include Eddy.cfg]
[include mainsail.cfg]
[include HotEnd.cfg]
[include SBLED.cfg]
[include timeout.cfg]
[include Macro.cfg]
[include LCD.cfg]
[include klipperExpander.cfg]
[include lights.cfg]
#[include Knomi.cfg]
#[include lights.cfg]

[exclude_object]

[input_shaper]
#shaper_freq_x: ...
#shaper_type_x: ...
#shaper_freq_y: 34.6
#shaper_type_y: mzv

[printer]
kinematics: corexz
max_velocity: 500
max_accel: 1500
max_z_velocity: 50
max_z_accel: 1500
square_corner_velocity: 4.0

[temperature_sensor CB1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor M5P]
sensor_type: temperature_mcu
min_temp: 10
max_temp: 100

[temperature_sensor CHAMBER]
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
min_temp: 10
max_temp: 200

[stepper_x]
step_pin: PC8
dir_pin: PC9
enable_pin: !PA15
rotation_distance: 40
endstop_pin: EBBCan:gpio24 
position_endstop: 0
position_max: 220
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32


[stepper_y]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA13
rotation_distance: 40
endstop_pin: ^PD2
position_endstop: 0
position_max: 235
homing_speed: 200
full_steps_per_rotation: 200
microsteps: 32

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
rotation_distance: 40
endstop_pin: probe:z_virtual_endstop
position_max: 250
full_steps_per_rotation: 200
microsteps: 32

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 200

#[fan]
#[heater_fan HOTEND]
#pin: PA3
#heater: extruder
#heater_temp: 50.0

#[heater_fan fan1]
[controller_fan M5P_FAN]
pin: PA4
#heater: extruder
#heater_temp: 30.0

#[heater_fan SoC_fan]
#pin: CB1: gpio79
#pin: RPI: gpio26

########################################
# TMC2209 configuration
########################################

[tmc2209 stepper_x]
uart_pin: PD9
run_current: 0.800
diag_pin: PD3
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
diag_pin: PD2
stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3
stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2
#stealthchop_threshold: 1

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 55.058
#*# pid_ki = 4.034
#*# pid_kd = 187.884
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 32.983
#*# pid_ki = 11.573
#*# pid_kd = 23.500
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 57.0
#*# shaper_type_y = ei
#*# shaper_freq_y = 61.2
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3202296.660,0.087500:3202239.243,0.131250:3202119.306,
#*# 	0.168750:3202005.345,0.212500:3201877.396,0.250000:3201756.745,
#*# 	0.287500:3201596.580,0.331250:3201464.058,0.368750:3201339.874,
#*# 	0.412500:3201200.990,0.450000:3201102.565,0.487500:3200972.181,
#*# 	0.531250:3200867.021,0.568750:3200747.949,0.612500:3200635.944,
#*# 	0.650000:3200518.971,0.687500:3200415.861,0.731250:3200288.746,
#*# 	0.768750:3200177.141,0.812500:3200050.231,0.850000:3199939.177,
#*# 	0.887500:3199828.107,0.931250:3199718.535,0.968750:3199635.729,
#*# 	1.012500:3199538.764,1.050000:3199451.553,1.087500:3199324.092,
#*# 	1.131250:3199243.866,1.168750:3199131.021,1.212500:3199032.592,
#*# 	1.250000:3198949.918,1.287500:3198859.362,1.331250:3198773.432,
#*# 	1.368750:3198673.705,1.412500:3198593.160,1.450000:3198510.652,
#*# 	1.487500:3198421.440,1.531250:3198313.626,1.568750:3198240.040,
#*# 	1.612500:3198127.536,1.650000:3198024.616,1.687500:3197972.343,
#*# 	1.731250:3197902.776,1.768750:3197829.090,1.812500:3197763.042,
#*# 	1.850000:3197687.972,1.887500:3197606.970,1.931250:3197519.316,
#*# 	1.968750:3197424.842,2.012500:3197358.919,2.050000:3197294.601,
#*# 	2.087500:3197227.316,2.131250:3197155.820,2.168750:3197087.588,
#*# 	2.212500:3197017.556,2.250000:3196964.214,2.287500:3196878.957,
#*# 	2.331250:3196819.695,2.368750:3196743.453,2.412500:3196667.706,
#*# 	2.450000:3196598.221,2.487500:3196560.116,2.531250:3196504.054,
#*# 	2.568750:3196425.330,2.612500:3196379.514,2.650000:3196331.157,
#*# 	2.687500:3196253.449,2.731250:3196187.414,2.768750:3196135.261,
#*# 	2.812500:3196074.734,2.850000:3196012.260,2.887500:3195969.284,
#*# 	2.931250:3195902.473,2.968750:3195846.571,3.012500:3195808.223,
#*# 	3.050000:3195764.078,3.087500:3195700.958,3.131250:3195637.298,
#*# 	3.168750:3195597.015,3.212500:3195529.374,3.250000:3195494.283,
#*# 	3.287500:3195436.423,3.331250:3195398.485,3.368750:3195353.912,
#*# 	3.412500:3195302.785,3.450000:3195252.501,3.487500:3195200.298,
#*# 	3.531250:3195140.436,3.568750:3195101.951,3.612500:3195059.826,
#*# 	3.650000:3195000.864,3.687500:3194983.172,3.731250:3194936.531,
#*# 	3.768750:3194876.606,3.812500:3194844.759,3.850000:3194767.217,
#*# 	3.887500:3194754.206,3.931250:3194733.558,3.968750:3194668.234,
#*# 	4.012500:3194639.071,4.050000:3194579.646
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 35.401815
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.099378, 0.128806, 0.120583, 0.134518, 0.109575, 0.049172, 0.052384, 0.037763, -0.037790, -0.031491, -0.001442, 0.007685, 0.004016, -0.010491, 0.047558, 0.037772, 0.062717, 0.074823, 0.039378
#*# 	  0.152417, 0.175604, 0.155827, 0.119279, 0.106206, 0.082912, 0.053999, 0.039369, -0.024302, -0.001353, -0.012360, -0.012360, -0.012227, -0.036213, 0.025852, 0.029431, 0.080892, 0.076173, 0.045363
#*# 	  0.170096, 0.140220, 0.130648, 0.149688, 0.132635, 0.064912, 0.063794, 0.050770, 0.022183, -0.041013, 0.014934, -0.006822, 0.014889, 0.023078, 0.047558, 0.050770, 0.055117, 0.089170, 0.006687
#*# 	  0.197084, 0.202473, 0.176248, 0.134511, 0.140816, 0.073481, 0.045375, 0.012204, 0.012204, 0.006701, -0.012360, -0.001353, -0.038571, -0.043406, 0.017708, 0.049164, 0.052384, 0.091190, 0.027553
#*# 	  0.199778, 0.175597, 0.156467, 0.170096, 0.121211, 0.098054, 0.036698, 0.053999, 0.035569, 0.020393, -0.005032, 0.012204, 0.012204, 0.014890, 0.009520, 0.020393, 0.065935, 0.054070, 0.020393
#*# 	  0.197098, 0.241135, 0.197084, 0.167387, 0.153705, 0.110304, 0.068129, 0.049164, -0.004187, 0.020393, -0.031495, -0.001353, -0.006857, -0.006857, 0.014890, -0.019454, 0.070695, 0.060573, 0.016724
#*# 	  0.236316, 0.181061, 0.188925, 0.195297, 0.156474, 0.108898, 0.077527, 0.069383, 0.043169, -0.023480, 0.028581, -0.009556, 0.014889, 0.020393, 0.042660, 0.050770, 0.067106, 0.078873, -0.036217
#*# 	  0.257212, 0.257864, 0.218818, 0.191635, 0.167387, 0.125647, 0.077527, 0.045375, 0.039369, -0.009557, 0.014889, 0.006701, -0.001353, -0.029019, 0.020393, 0.017708, 0.073421, 0.067085, 0.004016
#*# 	  0.257121, 0.224188, 0.213325, 0.206125, 0.166039, 0.102100, 0.091190, 0.074834, 0.049705, 0.028448, -0.001368, 0.036077, 0.023078, 0.025763, 0.017560, 0.037772, 0.072142, 0.070695, 0.007685
#*# 	  0.285304, 0.263430, 0.218803, 0.202551, 0.168793, 0.142127, 0.104852, 0.044299, 0.035574, 0.036692, -0.006872, 0.031133, -0.017108, 0.020393, 0.036077, 0.034480, 0.080286, 0.078873, 0.009475
#*# 	  0.303466, 0.272457, 0.240445, 0.239762, 0.193431, 0.142010, 0.116775, 0.073414, 0.065988, 0.014889, 0.049164, 0.047558, 0.039369, 0.047478, 0.054070, 0.023078, 0.061647, 0.087151, -0.001363
#*# 	  0.277658, 0.325734, 0.275099, 0.220605, 0.189868, 0.138319, 0.116775, 0.070722, 0.052976, 0.027652, 0.040975, 0.045801, 0.036157, 0.039369, 0.049164, 0.063794, 0.093889, 0.068682, 0.023973
#*# 	  0.308583, 0.279326, 0.255050, 0.215146, 0.171488, 0.160576, 0.134511, 0.095236, 0.083012, 0.063794, 0.068691, 0.063794, 0.057291, 0.036166, 0.068691, 0.058968, 0.102093, 0.107545, 0.038833
#*# 	  0.306024, 0.313921, 0.298265, 0.256491, 0.235629, 0.157881, 0.134518, 0.092543, 0.080219, 0.059452, 0.062188, 0.065480, 0.028581, 0.049164, 0.060502, 0.080892, 0.107552, 0.105447, 0.009475
#*# 	  0.313964, 0.323702, 0.272457, 0.253686, 0.237010, 0.155120, 0.140761, 0.125640, 0.099367, 0.055676, 0.062179, 0.085031, 0.074834, 0.049172, 0.074834, 0.091190, 0.065982, 0.119328, 0.049699
#*# 	  0.370545, 0.345275, 0.313836, 0.250933, 0.250925, 0.195228, 0.126895, 0.119328, 0.093949, 0.067053, 0.076854, 0.076854, 0.065400, 0.063794, 0.074834, 0.091190, 0.125640, 0.097348, 0.047516
#*# 	  0.372027, 0.355570, 0.269898, 0.293129, 0.255058, 0.151011, 0.156467, 0.109575, 0.076843, 0.087051, 0.063785, 0.085031, 0.052464, 0.054070, 0.091190, 0.105525, 0.089170, 0.121211, 0.073488
#*# 	  0.382484, 0.375480, 0.327668, 0.287975, 0.259271, 0.186517, 0.111657, 0.100747, 0.096582, 0.052970, 0.058382, 0.076854, 0.068691, 0.060582, 0.050778, 0.091190, 0.108905, 0.101397, 0.067005
#*# 	  0.381463, 0.293130, 0.267620, 0.218808, 0.181061, 0.153772, 0.130679, 0.101386, 0.074835, 0.050778, 0.039378, 0.060582, 0.055605, 0.025763, 0.049093, 0.064864, 0.063785, 0.103506, 0.062188
#*# x_count = 19
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 209.98
#*# min_y = 30.0
#*# max_y = 210.0
